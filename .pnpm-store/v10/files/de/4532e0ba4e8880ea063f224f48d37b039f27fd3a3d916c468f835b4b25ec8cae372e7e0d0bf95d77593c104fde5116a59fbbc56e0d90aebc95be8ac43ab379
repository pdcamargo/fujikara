// src/index.ts
import path2 from "node:path";

// src/errors.ts
import path from "node:path";
var handledErrors = ["transformer:validation-error", "collector:parse-error"];
function isUnknownError(event) {
  return !handledErrors.includes(event);
}
function registerErrorListeners(builder) {
  builder.on("transformer:validation-error", (event) => {
    console.log();
    console.log(
      "Validation failed on",
      path.join(event.collection.directory, event.file.path) + ":"
    );
    console.log(event.error.message);
    console.log();
  });
  builder.on("collector:parse-error", (event) => {
    console.log();
    console.log("Failed to parse file", path.join(event.filePath) + ":");
    console.log(event.error.message);
    console.log();
  });
}

// src/index.ts
function configureLogging(builder) {
  builder.on("builder:start", () => {
    console.log("build started ...");
  });
  builder.on("builder:end", (event) => {
    console.log(
      "... finished build of",
      event.stats.collections,
      event.stats.collections === 1 ? "collection" : "collections",
      "and",
      event.stats.documents,
      event.stats.documents === 1 ? "document" : "documents",
      "in",
      event.endedAt - event.startedAt + "ms"
    );
  });
  builder.on("watcher:config-changed", () => console.log("... config changed"));
  builder.on("watcher:file-changed", (event) => {
    const relativePath = path2.relative(process.cwd(), event.filePath);
    if (event.modification === "delete") {
      console.log("... file", relativePath, "deleted");
    } else {
      console.log("... file", relativePath, "changed");
    }
  });
  builder.on("transformer:document-skipped", (event) => {
    const relativePath = path2.relative(process.cwd(), event.filePath);
    console.log("... document", relativePath, "skipped", "due to", event.reason);
  });
  registerErrorListeners(builder);
  builder.on("_error", ({ _event, error }) => {
    if (isUnknownError(_event)) {
      console.log("... error", error.message);
    }
  });
}
export {
  configureLogging
};
